<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How to set Docker Resources Limit | Eva Villarreal Guzmán</title>
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="How to set Docker Resources Limit">
<meta name="author" content="Eva Villarreal Guzmán">
<meta property="og:locale" content="en_US">
<meta name="description" content="By default, Docker don’t limit the amount of memory and CPU that a container can use. The container can use as much of a given resources as the host’s kernel scheduler allows.">
<meta property="og:description" content="By default, Docker don’t limit the amount of memory and CPU that a container can use. The container can use as much of a given resources as the host’s kernel scheduler allows.">
<link rel="canonical" href="http://localhost:4000/docker/2021/12/02/docker-limit-resources.html">
<meta property="og:url" content="http://localhost:4000/docker/2021/12/02/docker-limit-resources.html">
<meta property="og:site_name" content="Eva Villarreal Guzmán">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-12-02T00:00:00-03:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="How to set Docker Resources Limit">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Eva Villarreal Guzmán"},"dateModified":"2021-12-02T00:00:00-03:00","datePublished":"2021-12-02T00:00:00-03:00","description":"By default, Docker don’t limit the amount of memory and CPU that a container can use. The container can use as much of a given resources as the host’s kernel scheduler allows.","headline":"How to set Docker Resources Limit","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/docker/2021/12/02/docker-limit-resources.html"},"url":"http://localhost:4000/docker/2021/12/02/docker-limit-resources.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Eva Villarreal Guzmán">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="Eva Villarreal Guzmán" src="" onerror="this.style.display='none'">
  Eva Villarreal Guzmán
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/archives.html">ARCHIVES</a><a class="page-link" href="/categories.html">CATEGORIES</a><a class="page-link" href="/">HOME</a><a class="page-link" href="/tags.html">TAGS</a>









<span class="page-link">



<div id="google_translate_element" style="display: none;">
</div>

<span class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
  </ul>
</span>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</span>
</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">How to set Docker Resources Limit</h1>
  <h2 class="post-subtitle">In this article we’ll explain how to enable resources limitation in Docker, and how to set CPU and memory limits in containers.</h2>

  <p class="post-meta">
    <time class="dt-published" datetime="2021-12-02T00:00:00-03:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Dec 02, 2021
    </time>

    
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 7 mins</span>
  </p>
<div class="post-tags"><a class="post-tag" href="/tags.html#docker">#docker</a></div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <p>By default, Docker don’t limit the amount of memory and CPU that a container can use. The container can use as much of a given resources as the host’s kernel scheduler allows.</p>

<p>It’s important to limit the resources that can consume a container. When the kernel detect that the computer have little memory, it’s throws an <code class="language-plaintext highlighter-rouge">Out of Memory Exception</code> and starts killing process to free up memory, and this can bring the entire system down. To avoid that circunstancies, you must execute test in your application and calculate the amount of resources needed, and then limit the container to use a rational amount of resources.</p>

<p>You can view the statistics of your Docker containers with the  <code class="language-plaintext highlighter-rouge">stats</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker stats <span class="o">[</span>docker_image]
</code></pre></div></div>

<h2 id="configure-system-to-enabled-limiting-resources">Configure system to enabled limiting resources</h2>

<p>Before limiting the resources of a container it’s important to check that the kernel of the host allow this. Run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker info
</code></pre></div></div>

<p>If you receive the following warning in the output:</p>

<pre><code class="language-output">WARNING: Noswaplimitsupport
</code></pre>

<p>So, you must enable the functionality in the kernel. To achieve this, edit the file that is located in <code class="language-plaintext highlighter-rouge">/etc/default/grub</code>, and then add the following line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1"
</code></pre></div></div>

<p>Save the changes and update the GRUB configuration with the command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>update-grub
</code></pre></div></div>

<p>Then, reboot your machine for the changes to take place:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>shutdown <span class="nt">-r</span>
</code></pre></div></div>

<p>Once the machine has restarted, make sure that the changes have been made:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker info
</code></pre></div></div>

<p>You shouldn’t received the warning <code class="language-plaintext highlighter-rouge">WARNING: Noswaplimitsupport</code> this time.</p>

<h2 id="limit-container-memory-access">Limit Container Memory Access</h2>

<p>There are different ways to limit RAM to containers:</p>

<h3 id="configuring-the-maximum-amount-of-memory-a-container-can-use">Configuring the maximum amount of memory a container can use</h3>

<p>Add the  <code class="language-plaintext highlighter-rouge">--memory</code> option to the command <code class="language-plaintext highlighter-rouge">docker run</code> for limit the maximum amount of memory of a container. Within the command, specify how much memory you want dedicate to that specific container.</p>

<p>The syntax is the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--memory</span><span class="o">=</span><span class="s2">"[memory_limit]"</span> <span class="o">[</span>docker_image]
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">memory_limit</code> should be a positive integer following by the suffix b, k, m o g (short for bytes, kilobytes, megabytes o gigabytes).</p>

<p>For example, to run an instance of a Ubuntu container and configurate a limit to 1GB, the command should be as follow:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--memory</span><span class="o">=</span><span class="s2">"1g"</span> ubuntu
</code></pre></div></div>

<h3 id="defining-the-amount-of-memory-that-a-container-can-swap-to-disk">Defining the amount of memory that a container can swap to disk</h3>

<p>Add the option <code class="language-plaintext highlighter-rouge">swamp</code> to store data even after all RAM assigned to the container has been used up. It does this by ignoring the memory limitation and writing directly to the disk. Although this is a useful feature, it is not a recommended practice as it slows down performance.</p>

<p>The option <code class="language-plaintext highlighter-rouge">swamp</code> includes the total amount of non-swap memory plus the amount of swap memory reserved as backup.</p>

<p>The syntax is the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--memory</span><span class="o">=</span><span class="s2">"[memory_limit]"</span> <span class="nt">--memory-swap</span><span class="o">=</span><span class="s2">"[memory_limit]"</span> <span class="o">[</span>docker_image]
</code></pre></div></div>

<p>For example, to configure <code class="language-plaintext highlighter-rouge">--memory</code> to 1 GB, the amount of swap memory has to be greather than that. To run a container with an additional 1GB of swap memory, you should configurate the option <code class="language-plaintext highlighter-rouge">swamp</code> to 2 GB.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--memory</span><span class="o">=</span><span class="s2">"1g"</span> <span class="nt">--memory-swap</span><span class="o">=</span><span class="s2">"2g"</span> ubuntu
</code></pre></div></div>

<p>If you don’t want to use swap memory, give <code class="language-plaintext highlighter-rouge">--memory</code> and <code class="language-plaintext highlighter-rouge">--memory-swap</code> the same values.</p>

<h3 id="set-soft-limit-to-container-memory">Set soft limit to container memory</h3>

<p>When you limit the memory access to a container with the option <code class="language-plaintext highlighter-rouge">--memory</code> you are setting a hard limit that the container can’t to surpassed. However, you can set a soft limit with the option <code class="language-plaintext highlighter-rouge">--memory-reserve</code> which warns when the container reaches the end of its assigned memory but doesn’t stop any of its services.</p>

<p>If <code class="language-plaintext highlighter-rouge">--memory</code> limitations see are not set, setting the soft limit with <code class="language-plaintext highlighter-rouge">--memory-reservation</code> doesn’t completely limit container space. If you have both features enabled, the soft limit is always lower than the maximum space capacity.</p>

<p>For example, if you want that a Ubuntu container had a memory reservation of 750 MB and the maximun RAM capacity of 1 BG, the command is as following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--memory</span><span class="o">=</span><span class="s2">"1g"</span> <span class="nt">--memory-reservation</span><span class="o">=</span><span class="s2">"750m"</span> ubuntu
</code></pre></div></div>

<h2 id="limit-container-cpu-access">Limit Container CPU Access</h2>

<p>As memory limit, there are different ways to configure CPU limit:</p>

<h3 id="defining-a-cpu-limit">Defining a CPU limit</h3>

<p>The option <code class="language-plaintext highlighter-rouge">--cpus</code> allows you specify how much of the available CPU resources a container can use.</p>

<p>For example, if the host machine has two CPUs and you set <code class="language-plaintext highlighter-rouge">--cpus="1.5"</code>, the container is guaranteed at most one and a half of the CPUs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--cpus</span><span class="o">=</span><span class="s2">"1.5"</span> ubuntu
</code></pre></div></div>

<h3 id="assigning-dedicated-cpu-to-containers">Assigning dedicated CPU to containers</h3>

<p>You can use the option <code class="language-plaintext highlighter-rouge">--cpuset-cpus</code> to limit the specific CPUs or cores a container can use. There are two different formats:</p>

<ul>
  <li>a comma-separated list. For example: <code class="language-plaintext highlighter-rouge">0,2,4</code>
</li>
  <li>a hyphen-separated range. For example: <code class="language-plaintext highlighter-rouge">1-3</code>
</li>
</ul>

<p>CPUs are addressed using a zero based index. This means 0,2,4 tells Docker to allocate compute-power from the first, third, and fifth CPU.</p>

<p>For example, to run a container y allocate just the second CPU, the command is as following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">--rm</span> <span class="nt">--cpuset-cpus</span> 1 ubuntu <span class="nt">-c</span> 8 <span class="nt">-t</span> 20s
</code></pre></div></div>

<p>Because the set of CPUs is selected explicitly, the container is limited to the capacity of the set.</p>

<h3 id="cpu-shares-for-docker-containers">CPU Shares for Docker containers</h3>

<p>The option <code class="language-plaintext highlighter-rouge">--cpu-shares</code> allows you to give access to a greater or lesser proportion of the host machine’s CPU cycles. By default, it’s configure to 1024. To give a container relatively less CPU time set <code class="language-plaintext highlighter-rouge">--cpu-shares</code> to lower than 1024. To give a container relatively more CPU set <code class="language-plaintext highlighter-rouge">--cpu-shares</code> for Docker run to a value greater than 1024.</p>

<p>This is only enforced when CPU cycles are constrained. When plenty of CPU cycles are available, all containers use as much CPU as they need. In that way, this is a soft limit. It prioritizes container CPU resources for the available CPU cycles. It does not guarantee or reserve any specific CPU access.</p>

<p>For example, to run a container with less resources shared, the command is as following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--cpus-shares</span><span class="o">=</span><span class="s2">"700"</span> ubuntu
</code></pre></div></div>

<p>If <code class="language-plaintext highlighter-rouge">--cpus</code> or <code class="language-plaintext highlighter-rouge">--cpu-quota</code> is set then even if there is no contention for CPU time the container will be limited based. This can be good for predictable resource usage but is generally bad for utilisation.</p>

<h2 id="sources">Sources</h2>

<ul>
  <li><a href="https://phoenixnap.com/kb/docker-memory-and-cpu-limit">How to Set Docker Memory and CPU Usage Limit</a></li>
  <li><a href="https://docs.docker.com/config/containers/resource_constraints/#configure-the-default-cfs-scheduler/">Runtime options with Memory, CPUs, and GPUs</a></li>
  <li><a href="https://www.batey.info/cgroup-cpu-shares-for-docker.html">CPU Shares for Docker containers</a></li>
  <li><a href="https://www.thorsten-hans.com/docker-container-cpu-limits-explained">Docker Container CPU Limits Explained</a></li>
</ul>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/react/2021/11/26/react-performance.html" title="Optimizing Performance in React">Optimizing Performance in React</a><a class="next" href="/postgres/2021/12/13/connections-pool.html" title="Connection Pooling">Connection Pooling</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/docker/2022/01/08/https-con-docker-y-apache.html" title="Connection Pooling">HTTPS with Docker and Apache</a></li>
<li><a class="post-link" href="/postgres/2021/12/18/postgresql-too-many-clients.html" title="Connection Pooling">Sorry, too many clients already - error PostgreSQL</a></li>
<li><a class="post-link" href="/docker/2022/03/16/uid-y-gid-en-Docker.html" title="Connection Pooling">UID/GID in Docker</a></li>
<li><a class="post-link" href="/postgres/2021/12/13/connections-pool.html" title="Connection Pooling">Connection Pooling</a></li>
</ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>All rights reserved <span class="copyleft">©</span> Eva Villarreal Guzmán 2022 </div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
    </div>
  </div>
</footer>
</body>
</html>
